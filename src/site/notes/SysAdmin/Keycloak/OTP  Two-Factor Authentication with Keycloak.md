---
{"created":"2022-12-16T11:25:12 (UTC +01:00)","type":"webclip","url":"https://ultimatesecurity.pro/post/2fa/","author":"ultimatesecurity","dg-publish":true,"topics":["Keycloak"],"permalink":"/sys-admin/keycloak/otp-two-factor-authentication-with-keycloak/","dgPassFrontmatter":true}
---

From `=this.url`


> ## Excerpt
> We will learn how to configure Two-factor authentication in Keycloak

---
## What will I cover in this post?

We will learn how to configure Two-factor authentication in Keycloak

In this post, I plan on:

-   Explaining what is Two-Factor Authentication
-   Explaining what is Keycloak Two-Factor Authentication
-   Explaining how to configure Two-factor authentication in Keycloak

According to [wikipedia](https://en.wikipedia.org/wiki/Two-step_verification):  
Two-factor authentication (also known as 2FA) is a method of confirming a user’s claimed identity by utilizing a combination of two different factors:

1.  Something they know
2.  Something they have or something they are

### Keycloak Two-Factor Authentication

Keycloak authenticates users using:

1.  Password
2.  An one-time password (OTP)

A one-time password generated by [Google Authenticator](https://en.wikipedia.org/wiki/Google_Authenticator) or [FreeOTP](https://en.wikipedia.org/wiki/FreeOTP)

## Keycloak configuration

### Enforce new users to configure OTP

Open Keycloak admin page, open **Authentication**, go to the **Required Actions** tab.

Click on the **Default Action** in the **Configure OTP** row.

![](https://ultimatesecurity.pro/img/otp-configuration.JPG)

### Enforce an existing user to configure OTP

Open Keycloak admin page, open **Users**, select a user, go to the **Details** tab.

In the **Required User Actions** list select **Configure OTP**.

![](https://ultimatesecurity.pro/img/otp-configuration-users.jpg)

### OTP Policy configuration

Open Keycloak admin page, open **Authentication**, go to the **OTP Policy** tab.

![](https://ultimatesecurity.pro/img/otp-configuration-policy.jpg)

Keycloak documentation related to OTP Policies is [here](https://www.keycloak.org/docs/3.3/server_admin/topics/authentication/otp-policies.html)  

### Recommended OTP Policy

**Time based** OTP Type (TOTP) is considered a more secure. TOTP requires time be synchronized between Keycloak server and an end user device.

If the server and the device cannot be synchronized use **Counter Based** type (HOTP).

Configure **Look Ahead Window** to **3**.

## User’s Mobile Authenticator

### One Time Setup

A user will need to setup Mobile Authenticator upon the completion of the user name password authentication:

![](https://ultimatesecurity.pro/img/otp-configuration-mobile.jpg)

The example below shows the Google Authenticator.

#### Download

Download [Google Authenticator](https://play.google.com/store/apps/details?id=com.google.android.apps.authenticator2&hl=en).

#### Install Google Authenticator

![](https://ultimatesecurity.pro/img/otp-mobile-1.png)

#### Scan the QR code

![](https://ultimatesecurity.pro/img/otp-mobile-2.png)

#### Provide the generated code to the Keycloak setup login page

![](https://ultimatesecurity.pro/img/otp-mobile-3.png)

#### One Time Setup Video

You can watch the example of the registration in the video:

### Authentication using One-time code

A user will need to provide **One-time code** upon the completion of the user name password authentication:

![](https://ultimatesecurity.pro/img/otp-configuration-mobile-2.jpg)

#### Authentication Video

You can watch the example of the authentication in the video:

## Take-aways

You should now how to configure Two-factor authentication in Keycloak
